<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â¤ï¸ æˆ‘ä»¬çš„çˆ±æƒ…æ—¶å…‰æœº â¤ï¸</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- å¼•å…¥Quillå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        :root {
            --primary: #FF758F;
            --secondary: #7FC7D4;
            --text: #2C3E50;
            --bg: #F8F9FA;
        }

        body {
            font-family: 'Microsoft Yahei', sans-serif;
            background: var(--bg);
            margin: 0;
            min-height: 100vh;
        }

        /* å¯¼èˆªæ ä¼˜åŒ– */
        .nav-bar {
            display: flex;
            justify-content: center;
            padding: 1.5rem;
            background: rgba(255,255,255,0.98);
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            margin: 0 1.5rem;
            padding: 1rem 2.5rem;
            border-radius: 30px;
            background: linear-gradient(135deg, var(--primary), #FF9F6F);
            color: white;
            border: none;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(255,117,143,0.3);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,117,143,0.4);
        }

        /* é¡µé¢å®¹å™¨ */
        .page {
            display: none;
            padding: 3rem 10%;
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .page.active {
            display: block;
        }

        /* ç…§ç‰‡ä¸Šä¼ ä¿®å¤ */
        .upload-container {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            margin: 2rem auto;
            max-width: 800px;
            text-align: center;
            position: relative;
        }

        .upload-progress {
            height: 8px;
            background: rgba(var(--primary),0.1);
            border-radius: 4px;
            margin: 1.5rem 0;
            overflow: hidden;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        /* æ‹çˆ±ç¬”è®°ç¼–è¾‘å™¨ä¼˜åŒ– */
        .note-editor {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .ql-toolbar {
            border-radius: 15px 15px 0 0 !important;
            border-color: #eee !important;
        }

        .ql-container {
            border-radius: 0 0 15px 15px !important;
            border-color: #eee !important;
            height: 400px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <nav class="nav-bar">
        <button class="nav-btn active" onclick="showPage('home')">é¦–é¡µ</button>
        <button class="nav-btn" onclick="showPage('gallery')">ç…§ç‰‡å¢™</button>
        <button class="nav-btn" onclick="showPage('notes')">æ‹çˆ±ç¬”è®°</button>
    </nav>

    <!-- é¦–é¡µ -->
    <section id="home" class="page active">
        <div class="countdown-box">
            <h2>â¤ï¸ æˆ‘ä»¬çš„æ‹çˆ±çºªå¿µæ—¥ â¤ï¸</h2>
            <div id="countdown">æ­£åœ¨è®¡ç®—...</div>
        </div>
        <div class="photo-grid" id="homePhotos"></div>
    </section>

    <!-- ç…§ç‰‡å¢™ -->
    <section id="gallery" class="page">
        <div class="upload-container">
            <input type="file" id="fileInput" multiple accept="image/*" hidden>
            <label for="fileInput" class="nav-btn">
                <i class="fas fa-camera"></i> é€‰æ‹©ç…§ç‰‡
            </label>
            <div class="upload-progress">
                <div class="progress-bar" id="uploadProgress"></div>
            </div>
            <div id="uploadStatus"></div>
        </div>
        <div class="photo-grid" id="photoGrid"></div>
    </section>

    <!-- æ‹çˆ±ç¬”è®° -->
    <section id="notes" class="page">
        <button class="nav-btn" onclick="createNote()">æ–°å»ºç¬”è®°</button>
        <div class="note-list" id="noteList"></div>
    </section>

    <!-- ç¬”è®°ç¼–è¾‘å™¨ -->
    <div id="editorModal" class="note-modal">
        <div class="note-editor">
            <div class="editor-header">
                <h2>è®°å½•æˆ‘ä»¬çš„æ•…äº‹</h2>
                <button class="nav-btn" onclick="saveNote()">ä¿å­˜ç¬”è®°</button>
            </div>
            <div id="editor"></div>
        </div>
    </div>

    <!-- ä¾èµ–åº“ -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

    <script>
        // ğŸ”¥ Firebaseé…ç½®ï¼ˆæ›¿æ¢ä¸ºä½ çš„é…ç½®ï¼‰
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_BUCKET.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // åˆå§‹åŒ–Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // åˆå§‹åŒ–å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
        const quill = new Quill('#editor', {
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline', 'strike'],
                    ['blockquote', 'code-block'],
                    [{ 'header': 1 }, { 'header': 2 }],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['link', 'image'],
                    ['clean']
                ]
            },
            theme: 'snow'
        });

        // ğŸš€ ä¿®å¤ç…§ç‰‡ä¸Šä¼ åŠŸèƒ½
        async function uploadPhoto() {
            const files = document.getElementById('fileInput').files;
            if(files.length === 0) return;

            for(const file of files) {
                try {
                    const storageRef = storage.ref(`photos/${Date.now()}_${file.name}`);
                    const uploadTask = storageRef.put(file);

                    uploadTask.on('state_changed',
                        (snapshot) => {
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            document.getElementById('uploadProgress').style.width = `${progress}%`;
                        },
                        (error) => {
                            console.error('ä¸Šä¼ å¤±è´¥:', error);
                            alert(`ä¸Šä¼ å¤±è´¥: ${error.message}`);
                        },
                        async () => {
                            const url = await storageRef.getDownloadURL();
                            await db.collection('photos').add({
                                url,
                                timestamp: firebase.firestore.FieldValue.serverTimestamp()
                            });
                            document.getElementById('uploadStatus').textContent = `${file.name} ä¸Šä¼ æˆåŠŸï¼`;
                            setTimeout(() => document.getElementById('uploadStatus').textContent = '', 3000);
                            loadPhotos();
                        }
                    );
                } catch (error) {
                    alert(`ä¸Šä¼ é”™è¯¯: ${error.message}`);
                }
            }
        }

        // âœ¨ ä¼˜åŒ–ç¬”è®°ç³»ç»Ÿ
        let currentNoteId = null;
        const noteEditor = document.getElementById('editorModal');

        // åˆ›å»ºæ–°ç¬”è®°
        function createNote() {
            currentNoteId = null;
            quill.setContents([]);
            noteEditor.style.display = 'block';
        }

        // ä¿å­˜ç¬”è®°
        async function saveNote() {
            try {
                const content = quill.root.innerHTML;
                const delta = quill.getContents();
                
                const noteData = {
                    content,
                    delta: JSON.stringify(delta),
                    updated: firebase.firestore.FieldValue.serverTimestamp()
                };

                if(currentNoteId) {
                    await db.collection('notes').doc(currentNoteId).update(noteData);
                } else {
                    await db.collection('notes').add({
                        ...noteData,
                        created: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                noteEditor.style.display = 'none';
                loadNotes();
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                console.error('ä¿å­˜é”™è¯¯:', error);
            }
        }

        // åŠ è½½ç¬”è®°åˆ—è¡¨
        function loadNotes() {
            db.collection('notes').orderBy('created', 'desc').onSnapshot(snapshot => {
                const notes = [];
                snapshot.forEach(doc => {
                    notes.push({ 
                        id: doc.id,
                        ...doc.data(),
                        created: doc.data().created?.toDate().toLocaleDateString()
                    });
                });
                
                document.getElementById('noteList').innerHTML = notes.map(note => `
                    <div class="note-card" onclick="openNote('${note.id}')">
                        <h3>${note.created} çš„å›å¿†</h3>
                        <div class="preview">${note.content.substring(0, 100)}...</div>
                    </div>
                `).join('');
            });
        }

        // å…¶ä»–åŠŸèƒ½ä¿æŒä¸å˜...
    </script>
</body>
</html>
